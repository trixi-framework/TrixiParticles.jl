<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Time Integration · TrixiParticles.jl</title><meta name="title" content="Time Integration · TrixiParticles.jl"/><meta property="og:title" content="Time Integration · TrixiParticles.jl"/><meta property="twitter:title" content="Time Integration · TrixiParticles.jl"/><meta name="description" content="Documentation for TrixiParticles.jl."/><meta property="og:description" content="Documentation for TrixiParticles.jl."/><meta property="twitter:description" content="Documentation for TrixiParticles.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><script src="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.js"></script><link href="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">TrixiParticles.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../news/">News</a></li><li><a class="tocitem" href="../install/">Installation</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../development/">Development</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li><a class="tocitem" href="../visualization/">Visualization</a></li><li><span class="tocitem">Preprocessing</span><ul><li><a class="tocitem" href="../preprocessing/preprocessing/">Sampling of Geometries</a></li></ul></li><li><a class="tocitem" href="../gpu/">GPU Support</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../general/semidiscretization/">Semidiscretization</a></li><li><a class="tocitem" href="../general/initial_condition/">Initial Condition and Setups</a></li><li><a class="tocitem" href="../general/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../general/density_calculators/">Density Calculators</a></li><li><a class="tocitem" href="../general/smoothing_kernels/">Smoothing Kernels</a></li><li><a class="tocitem" href="../general/neighborhood_search/">Neighborhood Search</a></li><li><a class="tocitem" href="../general/util/">Util</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-11-3" type="checkbox"/><label class="tocitem" for="menuitem-11-3"><span class="docs-label">Systems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-11-3-1" type="checkbox"/><label class="tocitem" for="menuitem-11-3-1"><span class="docs-label">Fluid Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../systems/fluid/">Overview</a></li><li><a class="tocitem" href="../systems/weakly_compressible_sph/">Weakly Compressible SPH (Fluid)</a></li><li><a class="tocitem" href="../systems/entropically_damped_sph/">Entropically Damped Artificial Compressibility for SPH (Fluid)</a></li><li><a class="tocitem" href="../systems/implicit_incompressible_sph/">Implicit Incompressible SPH (Fluid)</a></li></ul></li><li><a class="tocitem" href="../systems/dem/">Discrete Element Method (Solid)</a></li><li><a class="tocitem" href="../systems/total_lagrangian_sph/">Total Lagrangian SPH (Elastic Structure)</a></li><li><a class="tocitem" href="../systems/boundary/">Boundary</a></li></ul></li><li class="is-active"><a class="tocitem" href>Time Integration</a><ul class="internal"><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Recommended-schemes"><span>Recommended schemes</span></a></li><li><a class="tocitem" href="#symplectic_schemes"><span>Symplectic schemes</span></a></li></ul></li><li><a class="tocitem" href="../callbacks/">Callbacks</a></li><li><a class="tocitem" href="../reference-trixibase/">TrixiBase.jl API Reference</a></li><li><a class="tocitem" href="../reference-pointneighbors/">PointNeighbors.jl API Reference</a></li></ul></li><li><a class="tocitem" href="../authors/">Authors</a></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../license/">License</a></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li class="is-active"><a href>Time Integration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Time Integration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/main/docs/src/time_integration.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="time_integration"><a class="docs-heading-anchor" href="#time_integration">Time integration</a><a id="time_integration-1"></a><a class="docs-heading-anchor-permalink" href="#time_integration" title="Permalink"></a></h1><p>TrixiParticles.jl uses a modular approach where time integration is just another module that can be customized and exchanged. The function <a href="../general/semidiscretization/#TrixiParticles.semidiscretize-Tuple{Any, Any}"><code>semidiscretize</code></a> returns an <code>ODEProblem</code> (see <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/ode_types/">the OrdinaryDiffEq.jl docs</a>), which can be integrated with <a href="https://github.com/SciML/OrdinaryDiffEq.jl">OrdinaryDiffEq.jl</a>.</p><p>In particular, a <a href="https://docs.sciml.ai/DiffEqDocs/stable/types/dynamical_types/"><code>DynamicalODEProblem</code></a> is returned, where the right-hand side is split into two functions, the <code>kick!</code>, which computes the derivative of the particle velocities and the <code>drift!</code>, which computes the derivative of the particle positions. This approach allows us to use <a href="#symplectic_schemes">specialized time integration methods that do not work with general <code>ODEProblem</code>s</a>. Note that this is not a true <code>DynamicalODEProblem</code> where the kick does not depend on the velocity. Therefore, not all integrators designed for <code>DynamicalODEProblem</code>s will work (properly) (see <a href="#kick_drift_kick">below</a>). However, all integrators designed for general <code>ODEProblem</code>s can be used.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>After obtaining an <code>ODEProblem</code> from <a href="../general/semidiscretization/#TrixiParticles.semidiscretize-Tuple{Any, Any}"><code>semidiscretize</code></a>, let us call it <code>ode</code>, we can pass it to the function <code>solve</code> of OrdinaryDiffEq.jl. For most schemes, we do the following:</p><pre><code class="language-julia hljs">using OrdinaryDiffEq
sol = solve(ode, Euler(),
            dt=1.0,
            save_everystep=false, callback=callbacks);</code></pre><p>Here, <code>Euler()</code> should in practice be replaced by a more useful scheme. <code>callbacks</code> should be a <code>CallbackSet</code> containing callbacks like the <a href="../callbacks/#TrixiParticles.InfoCallback-Tuple{}"><code>InfoCallback</code></a>. For callbacks, please refer to <a href="../callbacks/#Callbacks">the docs</a> and the example files. In this case, we need to either set a reasonable, problem- and resolution-dependent step size <code>dt</code>, or use the <a href="../callbacks/#TrixiParticles.StepsizeCallback-Tuple{}"><code>StepsizeCallback</code></a>, which overwrites the step size dynamically during the simulation based on a CFL-number. We always set <code>save_everystep=false</code>, or OrdinaryDiffEq.jl would return the solution vector for every time step, writing massive amounts of data into the RAM for large simulations. To visualize data for every time step, <a href="../callbacks/#Callbacks">callbacks</a> can be used.</p><p>Some schemes, e.g. the two schemes <code>RDPK3SpFSAL35</code> and <code>RDPK3SpFSAL49</code> mentioned below, support automatic time stepping, where the step size is determined automatically based on error estimates during the simulation. These schemes do not use the keyword argument <code>dt</code> and will ignore the step size set by the <a href="../callbacks/#TrixiParticles.StepsizeCallback-Tuple{}"><code>StepsizeCallback</code></a>. Instead, they will work with the tolerances <code>abstol</code> and <code>reltol</code>, which can be passed as keyword arguments to <code>solve</code>. The default tolerances are <code>abstol=1e-6</code> and <code>reltol=1e-3</code>.</p><h2 id="Recommended-schemes"><a class="docs-heading-anchor" href="#Recommended-schemes">Recommended schemes</a><a id="Recommended-schemes-1"></a><a class="docs-heading-anchor-permalink" href="#Recommended-schemes" title="Permalink"></a></h2><p>A list of schemes for general <code>ODEProblem</code>s can be found <a href="https://docs.sciml.ai/DiffEqDocs/stable/solvers/ode_solve/">here</a>. We commonly use the following three schemes:</p><ul><li><code>CarpenterKennedy2N54(williamson_condition=false)</code>: A five-stage, fourth order low-storage Runge-Kutta method designed by <a href="../references/#Carpenter1994">Carpenter and Kennedy</a> for hyperbolic problems.</li><li><code>RDPK3SpFSAL35()</code>: A 5-stage, third order low-storage Runge-Kutta scheme with embedded error estimator, optimized for compressible fluid mechanics [<a href="../references/#Ranocha2022">59</a>].</li><li><code>RDPK3SpFSAL49()</code>: A 9-stage, fourth order low-storage Runge-Kutta scheme with embedded error estimator, optimized for compressible fluid mechanics [<a href="../references/#Ranocha2022">59</a>].</li></ul><h2 id="symplectic_schemes"><a class="docs-heading-anchor" href="#symplectic_schemes">Symplectic schemes</a><a id="symplectic_schemes-1"></a><a class="docs-heading-anchor-permalink" href="#symplectic_schemes" title="Permalink"></a></h2><p>Symplectic schemes like the leapfrog method are often used for SPH.</p><h3 id="kick_drift_kick"><a class="docs-heading-anchor" href="#kick_drift_kick">Leapfrog kick-drift-kick</a><a id="kick_drift_kick-1"></a><a class="docs-heading-anchor-permalink" href="#kick_drift_kick" title="Permalink"></a></h3><p>The kick-drift-kick scheme of the leapfrog method, updating positions <span>$u$</span> and velocities <span>$v$</span> with the functions <span>$\operatorname{kick}$</span> and <span>$\operatorname{drift}$</span>, reads:</p><p class="math-container">\[\begin{align*}
v^{1/2} &amp;= v^0 + \frac{1}{2} \Delta t\, \operatorname{kick}(u^0, t^0), \\
u^1 &amp;= u^0 + \Delta t\, \operatorname{drift} \left( v^{1/2}, t^0 + \frac{1}{2} \Delta t \right), \\
v^1 &amp;= v^{1/2} + \frac{1}{2} \Delta t\, \operatorname{kick}(u^{1}, t^0 + \Delta t).
\end{align*}\]</p><p>In this form, it is also identical to the velocity Verlet scheme. Note that this only works as long as <span>$\operatorname{kick}$</span> does not depend on <span>$v$</span>, i.e., in the inviscid case. Once we add viscosity, <span>$\operatorname{kick}$</span> depends on both <span>$u$</span> and <span>$v$</span>. Then, the calculation of <span>$v^1$</span> requires <span>$v^1$</span> and becomes implicit.</p><p>The way this scheme is implemented in OrdinaryDiffEq.jl as <code>VerletLeapfrog</code>, the intermediate velocity <span>$v^{1/2}$</span> is passed to <span>$\operatorname{kick}$</span> in the last stage, resulting in first-order convergence when the scheme is used in the viscid case.</p><div class="admonition is-warning" id="Warning-cea4106f3b973680"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-cea4106f3b973680" title="Permalink"></a></header><div class="admonition-body"><p>Please do not use <code>VelocityVerlet</code> and <code>VerletLeapfrog</code> with TrixiParticles.jl. They will require very small time steps due to first-order convergence in the viscid case.</p></div></div><h3 id="Leapfrog-drift-kick-drift"><a class="docs-heading-anchor" href="#Leapfrog-drift-kick-drift">Leapfrog drift-kick-drift</a><a id="Leapfrog-drift-kick-drift-1"></a><a class="docs-heading-anchor-permalink" href="#Leapfrog-drift-kick-drift" title="Permalink"></a></h3><p>The drift-kick-drift scheme of the leapfrog method reads:</p><p class="math-container">\[\begin{align*}
u^{1/2} &amp;= u^0 + \frac{1}{2} \Delta t\, \operatorname{drift}(v^0, t^0), \\
v^1 &amp;= v^0 + \Delta t\, \operatorname{kick} \left( u^{1/2}, t^0 + \frac{1}{2} \Delta t \right), \\
u^1 &amp;= u^{1/2} + \frac{1}{2} \Delta t\, \operatorname{drift}(v^{1}, t^0 + \Delta t).
\end{align*}\]</p><p>In the viscid case where <span>$\operatorname{kick}$</span> depends on <span>$v$</span>, we can add another half step for <span>$v$</span>, yielding</p><p class="math-container">\[\begin{align*}
u^{1/2} &amp;= u^0 + \frac{1}{2} \Delta t\, \operatorname{drift}(v^0, u^0, t^0), \\
v^{1/2} &amp;= v^0 + \frac{1}{2} \Delta t\, \operatorname{kick}(v^0, u^0, t^0), \\
v^1 &amp;= v^0 + \Delta t\, \operatorname{kick} \left( v^{1/2}, u^{1/2}, t^0 + \frac{1}{2} \Delta t \right), \\
u^1 &amp;= u^{1/2} + \frac{1}{2} \Delta t\, \operatorname{drift}(v^{1}, u^{1}, t^0 + \Delta t).
\end{align*}\]</p><p>This scheme is implemented in OrdinaryDiffEq.jl as <code>LeapfrogDriftKickDrift</code> and yields the desired second order as long as <span>$\operatorname{drift}$</span> does not depend on <span>$u$</span>, which is always the case.</p><h3 id="Symplectic-position-Verlet"><a class="docs-heading-anchor" href="#Symplectic-position-Verlet">Symplectic position Verlet</a><a id="Symplectic-position-Verlet-1"></a><a class="docs-heading-anchor-permalink" href="#Symplectic-position-Verlet" title="Permalink"></a></h3><p>When the density is integrated (with <a href="../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a>), the density is appended to <span>$v$</span> as an additional dimension, so all previously mentioned schemes treat the density similar to the velocity. The SPH code <a href="https://github.com/DualSPHysics/DualSPHysics">DualSPHysics</a> implements a variation of the drift-kick-drift scheme where the density is updated separately. See <a href="../references/#Dominguez2022">Domínguez et al. 2022, Section 2.5.2</a>. In the following, we will call the derivative of the density <span>$R(v, u, t)$</span>, even though it is actually included in the <span>$\operatorname{kick}$</span> as an additional dimension.</p><p>This scheme reads</p><p class="math-container">\[\begin{align*}
u^{1/2} &amp;= u^0 + \frac{1}{2} \Delta t\, \operatorname{drift}(v^0, u^0, t^0), \\
v^{1/2} &amp;= v^0 + \frac{1}{2} \Delta t\, \operatorname{kick}(v^0, u^0, t^0), \\
\rho^{1/2} &amp;= \rho^0 + \frac{1}{2} \Delta t\, R(v^0, u^0, t^0), \\
v^1 &amp;= v^0 + \Delta t\, \operatorname{kick} \left( v^{1/2}, u^{1/2}, t^0 + \frac{1}{2} \Delta t \right), \\
\rho^1 &amp;= \rho^0 \frac{2 - \varepsilon^{1/2}}{2 + \varepsilon^{1/2}}, \\
u^1 &amp;= u^{1/2} + \frac{1}{2} \Delta t\, \operatorname{drift}(v^{1}, u^{1}, t^0 + \Delta t),
\end{align*}\]</p><p>where</p><p class="math-container">\[\varepsilon^{1/2} = - \frac{R(v^{1/2}, u^{1/2}, t^0 + \frac{1}{2} \Delta t)}{\rho^{1/2}} \Delta t.\]</p><p>This scheme is implemented in TrixiParticles.jl as <a href="#TrixiParticles.SymplecticPositionVerlet"><code>SymplecticPositionVerlet</code></a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.SymplecticPositionVerlet" href="#TrixiParticles.SymplecticPositionVerlet"><code>TrixiParticles.SymplecticPositionVerlet</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SymplecticPositionVerlet()</code></pre><p>Modified leapfrog integration scheme for Weakly Compressible SPH (WCSPH) when integrating the density with <a href="../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a>. This scheme is used by the SPH code <a href="https://github.com/DualSPHysics/DualSPHysics">DualSPHysics</a>. See <a href="https://github.com/DualSPHysics/DualSPHysics/wiki/3.-SPH-formulation#372-symplectic-position-verlet-scheme">https://github.com/DualSPHysics/DualSPHysics/wiki/3.-SPH-formulation#372-symplectic-position-verlet-scheme</a> and <a href="../references/#Dominguez2022">Domínguez et al. 2022, Section 2.5.2</a>.</p><p>See <a href="#time_integration">time integration</a> for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/976d4c73d490d47edb0f5fe433b7ef9b28b99fe9/src/general/time_integration.jl#L5-L17">source</a></section></article><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../systems/boundary/">« Boundary</a><a class="docs-footer-nextpage" href="../callbacks/">Callbacks »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 1 October 2025 12:26">Wednesday 1 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
