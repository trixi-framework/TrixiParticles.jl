<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implicit Incompressible SPH (Fluid) · TrixiParticles.jl</title><meta name="title" content="Implicit Incompressible SPH (Fluid) · TrixiParticles.jl"/><meta property="og:title" content="Implicit Incompressible SPH (Fluid) · TrixiParticles.jl"/><meta property="twitter:title" content="Implicit Incompressible SPH (Fluid) · TrixiParticles.jl"/><meta name="description" content="Documentation for TrixiParticles.jl."/><meta property="og:description" content="Documentation for TrixiParticles.jl."/><meta property="twitter:description" content="Documentation for TrixiParticles.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><script src="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.js"></script><link href="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TrixiParticles.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../news/">News</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><a class="tocitem" href="../../development/">Development</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../../visualization/">Visualization</a></li><li><span class="tocitem">Preprocessing</span><ul><li><a class="tocitem" href="../../preprocessing/preprocessing/">Sampling of Geometries</a></li></ul></li><li><a class="tocitem" href="../../gpu/">GPU Support</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../general/semidiscretization/">Semidiscretization</a></li><li><a class="tocitem" href="../../general/initial_condition/">Initial Condition and Setups</a></li><li><a class="tocitem" href="../../general/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../general/density_calculators/">Density Calculators</a></li><li><a class="tocitem" href="../../general/smoothing_kernels/">Smoothing Kernels</a></li><li><a class="tocitem" href="../../general/neighborhood_search/">Neighborhood Search</a></li><li><a class="tocitem" href="../../general/util/">Util</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-11-3" type="checkbox" checked/><label class="tocitem" for="menuitem-11-3"><span class="docs-label">Systems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-11-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-11-3-1"><span class="docs-label">Fluid Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../fluid/">Overview</a></li><li><a class="tocitem" href="../weakly_compressible_sph/">Weakly Compressible SPH (Fluid)</a></li><li><a class="tocitem" href="../entropically_damped_sph/">Entropically Damped Artificial Compressibility for SPH (Fluid)</a></li><li class="is-active"><a class="tocitem" href>Implicit Incompressible SPH (Fluid)</a><ul class="internal"><li><a class="tocitem" href="#Derivation"><span>Derivation</span></a></li><li><a class="tocitem" href="#Boundary-Handling"><span>Boundary Handling</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../dem/">Discrete Element Method (Solid)</a></li><li><a class="tocitem" href="../total_lagrangian_sph/">Total Lagrangian SPH (Elastic Structure)</a></li><li><a class="tocitem" href="../boundary/">Boundary</a></li></ul></li><li><a class="tocitem" href="../../time_integration/">Time Integration</a></li><li><a class="tocitem" href="../../callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../reference-trixibase/">TrixiBase.jl API Reference</a></li><li><a class="tocitem" href="../../reference-pointneighbors/">PointNeighbors.jl API Reference</a></li></ul></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li><a class="is-disabled">Systems</a></li><li><a class="is-disabled">Fluid Models</a></li><li class="is-active"><a href>Implicit Incompressible SPH (Fluid)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implicit Incompressible SPH (Fluid)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/main/docs/src/systems/implicit_incompressible_sph.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="iisph"><a class="docs-heading-anchor" href="#iisph">Implicit Incompressible SPH</a><a id="iisph-1"></a><a class="docs-heading-anchor-permalink" href="#iisph" title="Permalink"></a></h1><p>Implicit Incompressible SPH (IISPH) as introduced by <a href="../../references/#Ihmsen2013">Ihmsen et al. (2013)</a> is a method that achieves incompressibility by solving the pressure Poisson equation. The resulting linear system is iteratively solved with the relaxed Jacobi method. Unlike the <a href="../weakly_compressible_sph/#wcsph">weakly compressible SPH method</a>, incompressible methods determine pressure by enforcing the incompressibility constraint rather than using an equation of state.</p><article><details class="docstring" open="true"><summary id="TrixiParticles.ImplicitIncompressibleSPHSystem"><a class="docstring-binding" href="#TrixiParticles.ImplicitIncompressibleSPHSystem"><code>TrixiParticles.ImplicitIncompressibleSPHSystem</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">ImplicitIncompressibleSPHSystem(initial_condition,
                                smoothing_kernel, smoothing_length,
                                reference_density;
                                viscosity=nothing,
                                acceleration=ntuple(_ -&gt; 0.0, ndims(smoothing_kernel)),
                                omega=0.5, max_error=0.1, min_iterations=2,
                                max_iterations=20, time_step)</code></pre><p>System for particles of a fluid. The system employs implicit incompressible SPH (IISPH), iteratively solving a linear system for the pressure so that density remains within a specified tolerance of the rest value. See <a href="#iisph">Implicit Incompressible SPH</a> for more details on the method.</p><div class="admonition is-info" id="Time-Integration-142f2d02e3906ebe"><header class="admonition-header">Time Integration<a class="admonition-anchor" href="#Time-Integration-142f2d02e3906ebe" title="Permalink"></a></header><div class="admonition-body"><p>This system only supports time integration with <code>SymplecticEuler()</code>. No other schemes are currently supported.</p></div></div><p><strong>Arguments</strong></p><ul><li><code>initial_condition</code>:  <a href="../../general/initial_condition/#TrixiParticles.InitialCondition"><code>InitialCondition</code></a> representing the system&#39;s particles.</li><li><code>smoothing_kernel</code>:   Smoothing kernel to be used for this system.                       See <a href="../../general/smoothing_kernels/#smoothing_kernel">Smoothing Kernels</a>.</li><li><code>smoothing_length</code>:   Smoothing length to be used for this system.                       See <a href="../../general/smoothing_kernels/#smoothing_kernel">Smoothing Kernels</a>.</li><li><code>reference_density</code>:  Reference density used for the fluid particles</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>viscosity</code>:                  Currently, only <a href="../fluid/#ViscosityMorris"><code>ViscosityMorris</code></a>                               and <a href="../fluid/#ViscosityAdami"><code>ViscosityAdami</code></a> are supported.</li><li><code>acceleration</code>:               Acceleration vector for the system. (default: zero vector)</li><li><code>omega = 0.5</code>:                Relaxation parameter for the relaxed Jacobi scheme</li><li><code>max_error = 0.1</code>:            Maximum error (in %) for the termination condition in the relaxed Jacobi scheme</li><li><code>min_iterations = 2</code>:         Minimum number of iterations in the relaxed Jacobi scheme, independent from the termination condition</li><li><code>max_iterations = 20</code>:        Maximum number of iterations in the relaxed Jacobi scheme, independent from the termination condition</li><li><code>time_step</code>:                  Time step size used for the simulation</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/d2cbee59d262d256e763db55b9c45043bddb4077/src/schemes/fluid/implicit_incompressible_sph/system.jl#L1-L34">source</a></section></details></article><h2 id="Derivation"><a class="docs-heading-anchor" href="#Derivation">Derivation</a><a id="Derivation-1"></a><a class="docs-heading-anchor-permalink" href="#Derivation" title="Permalink"></a></h2><p>To derive the linear system of the pressure Poisson equation, we start by discretizing the continuity equation</p><p class="math-container">\[\frac{D\rho}{Dt} = - \rho \nabla \cdot \bm{v}.\]</p><p>For a particle <span>$i$</span>, discretizing the left-hand side of the equation with a forward difference yields</p><p class="math-container">\[\frac{\rho_i(t+ \Delta t) - \rho_i(t)}{\Delta t}.\]</p><p>The divergence in the right-hand side is discretized with the SPH discretization for particle <span>$i$</span> as</p><p class="math-container">\[-\frac{1}{\rho_i} \sum_j m_j \bm{v}_{ij} \nabla W_{ij},\]</p><p>where <span>$\bm{v}_{ij} = \bm{v}_i - \bm{v}_j$</span>.</p><p>Together, the following discretized version of the continuity equation for a particle <span>$i$</span> is achieved:</p><p class="math-container">\[\frac{\rho_i(t + \Delta t) - \rho_i(t)}{\Delta t} = \sum_j m_j \bm{v}_{ij}(t+\Delta t) \nabla W_{ij}.\]</p><p>Note that the linear system is only solved for fluid particles, so <span>$i$</span> always represents a fluid particle, and <span>$j$</span> represents all neighboring particles of <span>$i$</span>.</p><p>The right-hand side contains the unknown velocities <span>$\bm{v}_{ij}(t + \Delta t)$</span> at the next time step, making it an implicit formulation.</p><p>Using the semi-implicit Euler method, we can obtain the velocity in the next time step as</p><p class="math-container">\[\bm{v}_i(t + \Delta t) = \bm{v}_i(t) + \Delta t \frac{\bm{F}_i^\text{adv}(t) + \bm{F}_i^p(t)}{m_i},\]</p><p>where <span>$\bm{F}_i^{\text{adv}}$</span> denotes all non-pressure forces such as gravity, viscosity, surface tension and more, while <span>$\bm{F}_i^p$</span>denotes the unknown pressure forces, which we want to solve for.</p><p>Note that the IISPH is an incompressible method, which means that the density of the fluid remain constant over time. By assuming a fixed reference density <span>$\rho_0$</span> for all fluid particle over the whole time of the simulation, the density value at the next time step <span>$\rho_i(t + \Delta t)$</span> also has to be this rest density. So <span>$\rho_0$</span> can be plugged in for <span>$\rho_i(t + \Delta t)$</span> in the equation above.</p><p>The goal is to compute the pressure values required to obtain the pressure acceleration that ensures each particle reaches the rest density in the next time step. At the moment these pressure values are unknown in <span>$t$</span>, but all the non-pressure forces are already known. Therefore a predicted velocity can be calculated, which depends only on the non-pressure forces <span>$\bm{F}_i^{\text{adv}}$</span>:</p><p class="math-container">\[\bm{v}_i^{\text{adv}}(t+\Delta t)= \bm{v}_i(t) + \Delta t \frac{\bm{F}_i^{\text{adv}}(t)}{m_i},\]</p><p>Using this predicted velocity and the continuity equation, a predicted density can be defined in a similar way as</p><p class="math-container">\[\rho_i^{\text{adv}}(t + \Delta t)= \rho_i(t) + \Delta t \sum_j m_j \bm{v}_{ij}^{\text{adv}} \nabla W_{ij}(t).\]</p><p>To achieve the rest density, the unknown pressure forces must counteract the compression caused by the non-pressure forces. In other words, they must resolve the deviation between the predicted density and the reference density.</p><p>Therefore, the following equation needs to be fulfilled:</p><p class="math-container">\[\Delta t ^2 \sum_j m_j \left(  \frac{\bm{F}_i^p(t)}{m_i} - \frac{\bm{F}_j^p(t)}{m_j} \right) \nabla W_{ij}(t) = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>This expression is derived by substituting the reference density <span>$\rho_0$</span> for <span>$\rho_i(t+\Delta t)$</span> in the discretized continuity equation and inserting the definitions of the predicted velocity <span>$\bm{v}_{ij}(t+\Delta t)$</span> and predicted density <span>$\rho_i^{\text{adv}}$</span>.</p><p>The pressure force is defined as:</p><p class="math-container">\[\bm{F}_i^p(t) = -\frac{m_i}{\rho_i}  \nabla p_i = -m_i \sum_j m_j \left( \frac{p_i(t)}{\rho_i^2(t)} + \frac{p_j(t)}{\rho_j^2(t)} \right) \nabla W_{ij}.\]</p><p>Substituting this definition into the equation yields a linear system <span>$\bm{A}(t) \bm{p}(t) = \bm{b}(t)$</span> with one equation and one unknown pressure value for each particle. For <span>$n$</span> particles, this is a linear system with <span>$n$</span> equations and <span>$n$</span> unknowns:</p><p class="math-container">\[\sum_j a_{ij} p_j = b_i = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>To solve for the pressure values, a relaxed Jacobi scheme is used. This is an iterative numerical method to solve a linear system <span>$Ap=b$</span>. In each iteration, the new values of <span>$p$</span> are obtained as computed as</p><p class="math-container">\[p_i^{(k+1)} = (1-\omega) p_i^{(k)} + \omega \left( \frac{1}{a_{ii}} \left( b_i - \sum_{j \neq i} a_{ij} p_j^{(k)} \right)\right).\]</p><p>Substituting the right-hand side, we obtain</p><p class="math-container">\[p_i^{l+1} = (1-\omega) p_i^l + \omega \frac{\rho_0 - \rho_i^{\text{adv}} - \sum_{j \neq i} a_{ij}p_j^l}{a_{ii}}.\]</p><p>Therefore the diagonal elements <span>$a_{ii}$</span> and the sum <span>$\sum_{j \neq i} a_{ij}p_j^l$</span> need to be determined. This can be done efficiently by separating the pressure force acceleration into two components: One that describes the influence of particle <span>$i$</span>&#39;s own pressure on its displacement, and one that describes the displacement due to the pressure values of the neighboring particles <span>$j$</span>.</p><p>The pressure acceleration is given by:</p><p class="math-container">\[\Delta t^2 \frac{\bm{F}_i^p}{m_i} = -\Delta t^2 \sum_j m_j \left( \frac{p_i}{\rho_i^2} + \frac{p_j}{\rho_j^2} \right)\nabla W_{ij} =  \underbrace{\left(- \Delta t^2 \sum_j \frac{m_j}{\rho_i^2} \nabla W_{ij} \right) }_{d_{ii}} p_i + \sum_j \underbrace{-\Delta t^2 \frac{m_j}{\rho_j^2} \nabla W_{ij}}_{d_{ij}}p_j.\]</p><p>The <span>$d_{ii}p_i$</span> value describes the displacement of particle <span>$i$</span> because of the particle <span>$i$</span> and <span>$d_{ij}p_j$</span> describes the influence from the neighboring particles <span>$j$</span>. Using this new values the linear system can be rewritten as</p><p class="math-container">\[\rho_0 - \rho_i^{\text{adv}} = \sum_j m_j \left( d_{ii}p_i + \sum_k d_{ik}p_k - d_{jj}p_j - \sum_k d_{jk}p_k \right) \nabla W_{ij},\]</p><p>where the first sum over <span>$k$</span> loops over all neighbor particles of <span>$i$</span> and the second sum over <span>$k$</span> loops over the neighbor particles of <span>$j$</span> (which is a neighbor of <span>$i$</span>). So the sum over the neighboring pressure values <span>$p_j$</span> also includes the pressure values <span>$p_i$</span>, since <span>$i$</span> is a neighbor of <span>$j$</span>. To separate this sum, it can be written as</p><p class="math-container">\[\sum_k d_{jk} p_k = \sum_{k \neq i} d_{jk} p_k + d_{ji} p_i.\]</p><p>With this separation, the equation for the linear system can again be rewritten as</p><p class="math-container">\[\rho_0 - \rho_i^{\text{adv}} = p_i \sum_j m_j ( d_{ii} - d_{ji})\nabla W_{ij}  + \sum_j m_j \left ( \sum_k d_{ik} p_k - d_{jj} p_j - \sum_{k \neq i} d_{jk}p_k \right) \nabla W_{ij}.\]</p><p>In this formulation all coefficients that are getting multiplied with the pressure value <span>$p_i$</span> are separated from the other. The diagonal elements <span>$a_{ii}$</span> can therefore be defined as:</p><p class="math-container">\[a_{ii} = \sum_j m_j ( d_{ii} - d_{ji})\nabla W_{ij}.\]</p><p>The remaining part of the equation represents the influence of the other pressure values <span>$p_j$</span>. ​Hence, the final relaxed Jacobi iteration takes the form:</p><p class="math-container">\[p_i^{l+1} = (1 - \omega) p_i^{l} + \omega \frac{1}{a_{ii}} \left( \rho_0 -\rho_i^{\text{adv}} - \sum_j m_j \left( \sum_k d_{ik} p_k^l - d_{jj} p_j^l - \sum_{k \neq i} d_{jk} p_k^l \right) \nabla W_{ij} \right).\]</p><p>Because interactions are local, limited to particles within the kernel support defined by the smoothing length, each particle&#39;s pressure <span>$p_i$</span> depends only on its own value and nearby particles. Consequently, the matrix <span>$A$</span> is sparse (most entries are zero).</p><p>Note that this expression is not completely correct yet, since <span>$j$</span> represents all neighboring particles of <span>$i$</span> and some values like <span>$d_{jj}$</span> are not defined for boundary particles. The boundary handling is being explained in more detail later.</p><p>The diagonal elements <span>$a_{ii}$</span> get computed and stored at the beginning of the simulation step and remain unchanged throughout the relaxed Jacobi iterations. The same applies for the <span>$d_{ii}$</span>. The coefficients <span>$d_{ij}$</span> are computed, but not stored, as part of the calculation of <span>$a_{ii}$</span>. During the Jacobi iterations, two loops over all particles are performed: The first updates the values of <span>$\sum_j d_{ij}$</span> and the second computes the updated pressure values <span>$p_i^{l+1}$</span>.</p><p>The final pressure update follows the equation of the relaxed Jacobi scheme as stated above, with two exceptions:</p><h4 id="1.-Pressure-clamping"><a class="docs-heading-anchor" href="#1.-Pressure-clamping">1. Pressure clamping</a><a id="1.-Pressure-clamping-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Pressure-clamping" title="Permalink"></a></h4><p>To avoid negative pressure values, one can enable pressure clamping. In this case, the pressure update is given by</p><p class="math-container">\[p_i^{l+1} = \max \left(0, (1-\omega) p_i^l + \omega \frac{\rho_0 - \rho_i^{\text{adv}} - \sum_{j \neq i} a_{ij}p_j^l}{a_{ii}}\right).\]</p><h4 id="2.-Small-diagonal-elements"><a class="docs-heading-anchor" href="#2.-Small-diagonal-elements">2. Small diagonal elements</a><a id="2.-Small-diagonal-elements-1"></a><a class="docs-heading-anchor-permalink" href="#2.-Small-diagonal-elements" title="Permalink"></a></h4><p>If the diagonal element <span>$a_{ii}$</span> becomes too small or even zero, the simulation may become unstable. This can occur, for example, if a particle is isolated and receives little or no influence from neighboring particles, or due to numerical cancellations. In such cases, the updated pressure value is set to zero.</p><p>There are also other options, like setting <span>$a_{ii}$</span> to the threshold value if it is beneath and then update with the usual equation, or just don&#39;t update the pressure value at all, and continue with the old value. The numerical error introduced by this technique remains small, as only isolated or almost isolated particles are affected.</p><h2 id="Boundary-Handling"><a class="docs-heading-anchor" href="#Boundary-Handling">Boundary Handling</a><a id="Boundary-Handling-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-Handling" title="Permalink"></a></h2><p>The previously introduced formulation did not distinguish between fluid and boundary particles. To account boundary interactions correctly, a few modifications to the previous equations are required.</p><p>First, the discretized form of the continuity equation must be adapted for the case in which a neighboring particle is a boundary particle. From now on, we distinguish between neighboring fluid particles (indexed by <span>$f$</span>) and neighboring boundary particles (indexed by <span>$b$</span>). We continue to use the index <span>$j$</span> if we want to refer to all neighboring particles.</p><p>The updated discretized continuity equation becomes:</p><p class="math-container">\[\frac{\rho_i(t + \Delta t) - \rho_i(t)}{\Delta t} = \sum_f m_f \bm{v}_{if}(t+\Delta t) \nabla W_{if} + \sum_b m_b \bm{v}_{ib}(t+\Delta t) \nabla W_{ib}.\]</p><p>Since boundary particles have zero velocity, the difference between the fluid particle&#39;s velocity and the boundary particle&#39;s velocity simplifies to just the fluid particle&#39;s velocity <span>$\bm{v}_{ib}(t+\Delta t) = \bm{v}_{i}(t+\Delta t)$</span>. Accordingly, the predicted density <span>$\rho^{\text{adv}}$</span> becomes:</p><p class="math-container">\[\rho_i^{\text{adv}} = \rho_i (t) + \Delta t \sum_f m_f \bm{v}_{if}^{\text{adv}} \nabla W_{if}(t) + \Delta t \sum_b m_b \bm{v}_{i}^{\text{adv}} \nabla W_{ib}(t).\]</p><p>This leads to the following updated formulation of the linear system:</p><p class="math-container">\[\Delta t^2 \sum_f m_f \left(  \frac{\bm{F}_i^p(t)}{m_i} - \frac{\bm{F}_f^p(t)}{m_f} \right) \nabla W_{if} + \Delta t^2 \sum_b m_b \frac{\bm{F}_i^p(t)}{m_i} \nabla W_{ib} = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>Note that, since boundary particles are fixed, the force <span>$F_b^p$</span> is zero and does not appear in this equation.</p><p>The pressure force acting on a fluid particle is computed as:</p><p class="math-container">\[\bm{F}_i^p(t) = -\sum_f m_f \left( \frac{p_i(t)}{\rho_i^2(t)} + \frac{p_f(t)}{\rho_f^2(t)} \right) \nabla W_{if}(t) - \sum_b m_b \left( \frac{p_i(t)}{\rho_i^2(t)} + \frac{p_b(t)}{\rho_b^2(t)} \right) \nabla W_{ib}(t).\]</p><p>This also leads to an updated version of the equation for the diagonal elements:</p><p class="math-container">\[a_{ii} = \sum_j m_j ( d_{ii} - d_{ji})\nabla W_{ij} + \sum_b m_b (-d_{bi}) \nabla W_{ib}.\]</p><p>From this point forward, the computation of the coefficients required for the Jacobi scheme (such as <span>$d_{ii}$</span>, <span>$d_{ij}$</span> etc.) depends on the specific boundary density evaluation method used in the chosen boundary model.</p><h3 id="Pressure-Mirroring"><a class="docs-heading-anchor" href="#Pressure-Mirroring">Pressure Mirroring</a><a id="Pressure-Mirroring-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Mirroring" title="Permalink"></a></h3><p>When using pressure mirroring, the pressure value <span>$p_b$</span> of a boundary particle in the equation above is defined to be equal to the pressure of the corresponding fluid particle <span>$p_i$</span>. In other words, the boundary particle &quot;mirrors&quot; the pressure of the fluid particle interacting with it. As a result, the coefficient that describes the influence of a particle&#39;s own pressure value <span>$p_i$</span> ​must also include contributions from boundary particles. Therefore, the equation for calculating the coefficient <span>$d_{ii}$</span> must be adjusted as follows:</p><p class="math-container">\[d_{ii} = -\Delta t^2 \sum_f \frac{m_f}{\rho_i^2} \nabla W_{if} - \Delta t^2 \sum_b \frac{m_b}{\rho_i^2} \nabla W_{ib}.\]</p><p>The corresponding relaxed Jacobi iteration for pressure mirroring then becomes:</p><p class="math-container">\[\begin{align*}
p_i^{l+1} = (1 - \omega) p_i^l + \omega \frac{1}{a_{ii}} &amp;\left( \rho_0 - \rho_i^{\text{adv}}
 - \sum_f m_f \left( \sum_k d_{ik} p_k^l - d_{ff}p_f^l - \sum_{k \neq i} d_{fk} p_k^l \right) \nabla W_{if} \right. \\
&amp; \quad - \left. \sum_b m_b \sum_f d_{if} p_f^l \nabla W_{ib} \right).
\end{align*}\]</p><h3 id="Pressure-Zeroing"><a class="docs-heading-anchor" href="#Pressure-Zeroing">Pressure Zeroing</a><a id="Pressure-Zeroing-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Zeroing" title="Permalink"></a></h3><p>If pressure zeroing is used instead, the pressure value of a boundary particle <span>$p_b$</span> ​is assumed to be zero. Consequently, boundary particles do not contribute to the pressure forces acting on fluid particles. In this case, the computation of the coefficient <span>$d_{ii}$</span> remains unchanged and is given by:</p><p class="math-container">\[d_{ii} = -\Delta t^2 \sum_f \frac{m_f}{\rho_i^2} \nabla W_{if}.\]</p><p>The equation for the relaxed Jacobi iteration remains the same as in the pressure mirroring approach. However, the contribution from boundary particles vanishes due to their zero pressure:</p><p class="math-container">\[\begin{align*}
p_i^{l+1} = (1 - \omega) p_i^l + \omega \frac{1}{a_{ii}} &amp;\left( \rho_0 - \rho_i^{\text{adv}}
 - \sum_f m_f \left( \sum_k d_{ik} p_k^l - d_{ff}p_f^l - \sum_{k \neq i} d_{fk} p_k^l \right) \nabla W_{if} \right. \\
&amp; \quad - \left. \sum_b m_b \sum_j d_{if} p_f^l \nabla W_{ib} \right).
\end{align*}\]</p><h3 id="Pressure-Extrapolation"><a class="docs-heading-anchor" href="#Pressure-Extrapolation">Pressure Extrapolation</a><a id="Pressure-Extrapolation-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Extrapolation" title="Permalink"></a></h3><p>The density calculators <a href="../boundary/#TrixiParticles.AdamiPressureExtrapolation"><code>AdamiPressureExtrapolation</code></a> and <a href="../boundary/#TrixiParticles.BernoulliPressureExtrapolation"><code>BernoulliPressureExtrapolation</code></a> can also be used with IISPH. When using one of these pressure extrapolation methods the calculation of the PPE is exactly the same as when using pressure zeroing. So within the linear systems the pressure values are equal to zero (<span>$p_b=0$</span>) and therefore are not considered in the calculations. Only in the pressure acceleration, the extrapolated pressure values are used for the boundary particles. For more information on these two methods, refer to the docs for the <a href="../boundary/#boundary_models">boundary models</a>.</p><h3 id="Pressure-Boundaries"><a class="docs-heading-anchor" href="#Pressure-Boundaries">Pressure Boundaries</a><a id="Pressure-Boundaries-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Boundaries" title="Permalink"></a></h3><p>The <a href="#TrixiParticles.PressureBoundaries"><code>PressureBoundaries</code></a> density calculator was introduced by <a href="../../references/#Band2018b">Band et al. (2008)</a> specifically for IISPH fluid systems and can therefore only be used with IISPH. In the standard IISPH method the PPE is solved only for fluid particles. The pressure values for the boundary particles are then approximated, for example by using pressure mirroing. With <code>PressureBoundaries</code>, however, the linear system is extended to include the boundary particles as well. This means that the pressure values of both the fluid and the boundary particles are computed directly by solving the PPE. The main advantage of this method is that boundary pressures emerge naturally from the solution of the PPE, leading to a consistent pressure distribution across fluid and boundary domains. This avoids artificial constraints such as forcing <span>$p_{b}=0$</span> or <span>$p_{b}=p_{f}$</span>, and results in more accurate handling of fluid-boundary interactions.</p><p>The key difference is that the pressure values of the boundary particles now have their own PPE within the linear system. In other words, the boundary particle pressure <span>$p_b$</span> is also solved as part of the linear system. This leads to the following condition for the boundary particles <span>$b$</span>:</p><p class="math-container">\[\Delta t^2 \sum_f m_f \left(  \frac{\bm{F}_i^p(t)}{m_i} - \frac{\bm{F}_f^p(t)}{m_f} \right) \nabla W_{if} + \Delta t^2 \sum_b m_b \left(  \frac{\bm{F}_i^p(t)}{m_i} - \frac{\bm{F}_b^p(t)}{m_b} \right) \nabla W_{ib} = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>Note that in this case <span>$i$</span> is a boundary particle,<span>$f$</span> are its fluid neighbors, and <span>$b$</span> its boundary neighbors.</p><p>Since the pressure force for boundary particles is zero (as mentioned before), and because in this case <span>$i$</span> and <span>$b$</span> are both boundary particles, the PPE simplifies to</p><p class="math-container">\[\Delta t^2 \sum_f m_f - \frac{\bm{F}_f^p(t)}{m_f} \nabla W_{if} = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>If we substitute the definition of the pressure force from above, we obtain</p><p class="math-container">\[\Delta t^2 \sum_f m_f \left(  \sum_k m_k \left( \frac{p_f(t)}{\rho_j^2(t)} + \frac{p_k(t)}{\rho_k^2(t)} \right) \nabla W_{fk}\right) \nabla W_{if} = \rho_0 - \rho_i^{\text{adv}}.\]</p><p>where <span>$k$</span> represents all neighboring particles (fluid and boundary) of fluid particle <span>$f$</span>.</p><p>Because the boundary particles do not directly contribute to their own pressure force (only indirectly as neighbors of fluid particles), their <span>$d_{ii}$</span> values are zero. Therefore the diagonal elements simplify to</p><p class="math-container">\[a_{ii} = \sum_f \left( -d_{fi}\right) \nabla W_{if}.\]</p><p>The off-diagonal term <span>$\sum_{j \neq i} a_{ij} p_j$</span> in the relaxed Jacobi iteration for boundary particles takes the following form</p><p class="math-container">\[\sum_{j \neq i} a_{ij} p_j = \sum_f m_f \left( d_{ff} - \sum_{f_j} d_{ff_j}p_{f_j}\right) \nabla W_{if}.\]</p><p>But not only the addition of the boundary particles to the linear system changes when using pressure boundaries, also the PPE for the fluid particles is changing slightly.</p><p>Since the boundary particles have now their own pressure values, <span>$p_b$</span> is no longer eliminated (as in pressure zeroing or pressure extrapolation  with <span>$p_b=0$</span>) nor simply replaced by the fluid particle&#39;s pressure (as in pressure mirroring with <span>$p_b=p_i$</span>). Instead, <span>$p_b$</span>remains part of the PPE.</p><p>This has no effect on the diagonal elements <span>$a_{ii}$</span>, which are identical to those of the other density calculators. The <span>$d_{ii}$</span> values are also computed in the same way as for pressure zeroing or pressure extrapolation. However,  the off-diagonal term <span>$\sum_{j \neq i} a_{ij} p_j$</span> in the relaxed Jacobi iteration changes slightly. For pressure boundaries it takes the form</p><p class="math-container">\[ \sum_{j \neq i} a_{ij} p_j = \sum_f m_f \left( \sum_k d_{ik} p_k - d_{ff} p_f - \sum_{k \neq f} d_{fk} p_k \right) \nabla W_{if} \\
 + \sum_b m_b \left( \sum_k d_{ik} p_k  \right) \nabla W_{ib},\]</p><p>where <span>$k$</span>represents all neighboring particles of <span>$i$</span> (both fluid and boundary).</p><article><details class="docstring" open="true"><summary id="TrixiParticles.PressureBoundaries"><a class="docstring-binding" href="#TrixiParticles.PressureBoundaries"><code>TrixiParticles.PressureBoundaries</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">PressureBoundaries(; time_step, omega=0.4)</code></pre><p><code>density_calculator</code> for <code>BoundaryModelDummyParticles</code>.</p><p><strong>Keywords</strong></p><ul><li><code>time_step</code>: Time step size used for the simulation (has to be the same as for the IISPH fluid system)</li><li><code>omega</code>: Relaxation parameter for the relaxed Jacobi scheme (has to be the same as for the IISPH fluid system)</li></ul><div class="admonition is-info" id="Note-b6342b3891d6f857"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-b6342b3891d6f857" title="Permalink"></a></header><div class="admonition-body"><p>This boundary model can only be used in combination with the <a href="#TrixiParticles.ImplicitIncompressibleSPHSystem"><code>ImplicitIncompressibleSPHSystem</code></a>.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/d2cbee59d262d256e763db55b9c45043bddb4077/src/schemes/boundary/wall_boundary/dummy_particles.jl#L183-L194">source</a></section></details></article><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../entropically_damped_sph/">« Entropically Damped Artificial Compressibility for SPH (Fluid)</a><a class="docs-footer-nextpage" href="../dem/">Discrete Element Method (Solid) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 1 December 2025 16:17">Monday 1 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
