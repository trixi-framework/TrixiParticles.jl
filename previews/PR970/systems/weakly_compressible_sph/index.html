<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Weakly Compressible SPH (Fluid) · TrixiParticles.jl</title><meta name="title" content="Weakly Compressible SPH (Fluid) · TrixiParticles.jl"/><meta property="og:title" content="Weakly Compressible SPH (Fluid) · TrixiParticles.jl"/><meta property="twitter:title" content="Weakly Compressible SPH (Fluid) · TrixiParticles.jl"/><meta name="description" content="Documentation for TrixiParticles.jl."/><meta property="og:description" content="Documentation for TrixiParticles.jl."/><meta property="twitter:description" content="Documentation for TrixiParticles.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><script src="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.js"></script><link href="https://cdn.jsdelivr.net/npm/asciinema-player@3.6.3/dist/bundle/asciinema-player.min.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">TrixiParticles.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../news/">News</a></li><li><a class="tocitem" href="../../install/">Installation</a></li><li><a class="tocitem" href="../../getting_started/">Getting started</a></li><li><a class="tocitem" href="../../development/">Development</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../../visualization/">Visualization</a></li><li><span class="tocitem">Preprocessing</span><ul><li><a class="tocitem" href="../../preprocessing/preprocessing/">Sampling of Geometries</a></li></ul></li><li><a class="tocitem" href="../../gpu/">GPU Support</a></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="../../overview/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-11-2" type="checkbox"/><label class="tocitem" for="menuitem-11-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../general/semidiscretization/">Semidiscretization</a></li><li><a class="tocitem" href="../../general/initial_condition/">Initial Condition and Setups</a></li><li><a class="tocitem" href="../../general/interpolation/">Interpolation</a></li><li><a class="tocitem" href="../../general/density_calculators/">Density Calculators</a></li><li><a class="tocitem" href="../../general/smoothing_kernels/">Smoothing Kernels</a></li><li><a class="tocitem" href="../../general/neighborhood_search/">Neighborhood Search</a></li><li><a class="tocitem" href="../../general/util/">Util</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-11-3" type="checkbox" checked/><label class="tocitem" for="menuitem-11-3"><span class="docs-label">Systems</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-11-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-11-3-1"><span class="docs-label">Fluid Models</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../fluid/">Overview</a></li><li class="is-active"><a class="tocitem" href>Weakly Compressible SPH (Fluid)</a><ul class="internal"><li><a class="tocitem" href="#equation_of_state"><span>Equation of State</span></a></li><li><a class="tocitem" href="#density_diffusion"><span>Density Diffusion</span></a></li><li><a class="tocitem" href="#shifting"><span>Particle Shifting Technique</span></a></li><li><a class="tocitem" href="#transport_velocity_formulation"><span>Transport Velocity Formulation (TVF)</span></a></li><li><a class="tocitem" href="#tic"><span>Tensile Instability Control</span></a></li></ul></li><li><a class="tocitem" href="../entropically_damped_sph/">Entropically Damped Artificial Compressibility for SPH (Fluid)</a></li><li><a class="tocitem" href="../implicit_incompressible_sph/">Implicit Incompressible SPH (Fluid)</a></li></ul></li><li><a class="tocitem" href="../dem/">Discrete Element Method (Solid)</a></li><li><a class="tocitem" href="../total_lagrangian_sph/">Total Lagrangian SPH (Elastic Structure)</a></li><li><a class="tocitem" href="../boundary/">Boundary</a></li></ul></li><li><a class="tocitem" href="../../time_integration/">Time Integration</a></li><li><a class="tocitem" href="../../callbacks/">Callbacks</a></li><li><a class="tocitem" href="../../reference-trixibase/">TrixiBase.jl API Reference</a></li><li><a class="tocitem" href="../../reference-pointneighbors/">PointNeighbors.jl API Reference</a></li></ul></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">API Reference</a></li><li><a class="is-disabled">Systems</a></li><li><a class="is-disabled">Fluid Models</a></li><li class="is-active"><a href>Weakly Compressible SPH (Fluid)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Weakly Compressible SPH (Fluid)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/main/docs/src/systems/weakly_compressible_sph.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="wcsph"><a class="docs-heading-anchor" href="#wcsph">Weakly Compressible SPH</a><a id="wcsph-1"></a><a class="docs-heading-anchor-permalink" href="#wcsph" title="Permalink"></a></h1><p>Weakly compressible SPH as introduced by <a href="../../references/#Monaghan1994">Monaghan (1994)</a>. This formulation relies on a stiff <a href="#equation_of_state">equation of state</a> that generates large pressure changes for small density variations.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.WeaklyCompressibleSPHSystem" href="#TrixiParticles.WeaklyCompressibleSPHSystem"><code>TrixiParticles.WeaklyCompressibleSPHSystem</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">WeaklyCompressibleSPHSystem(initial_condition,
                            density_calculator, state_equation,
                            smoothing_kernel, smoothing_length;
                            acceleration=ntuple(_ -&gt; 0.0, NDIMS),
                            viscosity=nothing, density_diffusion=nothing,
                            pressure_acceleration=nothing,
                            shifting_technique=nothing,
                            buffer_size=nothing,
                            correction=nothing, source_terms=nothing,
                            surface_tension=nothing, surface_normal_method=nothing,
                            reference_particle_spacing=0.0))</code></pre><p>System for particles of a fluid. The weakly compressible SPH (WCSPH) scheme is used, wherein a stiff equation of state generates large pressure changes for small density variations. See <a href="#wcsph">Weakly Compressible SPH</a> for more details on the method.</p><p><strong>Arguments</strong></p><ul><li><code>initial_condition</code>:  <a href="../../general/initial_condition/#TrixiParticles.InitialCondition"><code>InitialCondition</code></a> representing the system&#39;s particles.</li><li><code>density_calculator</code>: Density calculator for the system.                       See <a href="../../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a> and <a href="../../general/density_calculators/#TrixiParticles.SummationDensity"><code>SummationDensity</code></a>.</li><li><code>state_equation</code>:     Equation of state for the system. See <a href="#TrixiParticles.StateEquationCole"><code>StateEquationCole</code></a>.</li><li><code>smoothing_kernel</code>:   Smoothing kernel to be used for this system.                       See <a href="../../general/smoothing_kernels/#smoothing_kernel">Smoothing Kernels</a>.</li><li><code>smoothing_length</code>:   Smoothing length to be used for this system.                       See <a href="../../general/smoothing_kernels/#smoothing_kernel">Smoothing Kernels</a>.</li></ul><p><strong>Keywords</strong></p><ul><li><code>acceleration</code>:               Acceleration vector for the system. (default: zero vector)</li><li><code>viscosity</code>:                  Viscosity model for this system (default: no viscosity).                               See <a href="../fluid/#ArtificialViscosityMonaghan"><code>ArtificialViscosityMonaghan</code></a> or <a href="../fluid/#ViscosityAdami"><code>ViscosityAdami</code></a>.</li><li><code>density_diffusion</code>:          Density diffusion terms for this system.                               See <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a>.</li><li><code>pressure_acceleration</code>:      Pressure acceleration formulation for this system.                               By default, the correct formulation is chosen based on the                               density calculator and the correction method.                               To use <a href="#tic">Tensile Instability Control</a>, pass                               <a href="#TrixiParticles.tensile_instability_control"><code>tensile_instability_control</code></a> here.</li><li><code>shifting_technique</code>:         <a href="#shifting">Shifting technique</a> or <a href="#transport_velocity_formulation">transport velocity                               formulation</a> to use                               with this system. Default is no shifting.</li><li><code>buffer_size</code>:                Number of buffer particles.                               This is needed when simulating with <a href="../boundary/#TrixiParticles.OpenBoundarySystem"><code>OpenBoundarySystem</code></a>.</li><li><code>correction</code>:                 Correction method used for this system. (default: no correction, see <a href="../fluid/#corrections">Corrections</a>)</li><li><code>source_terms</code>:               Additional source terms for this system. Has to be either <code>nothing</code>                               (by default), or a function of <code>(coords, velocity, density, pressure, t)</code>                               (which are the quantities of a single particle), returning a <code>Tuple</code>                               or <code>SVector</code> that is to be added to the acceleration of that particle.                               See, for example, <a href="../../general/semidiscretization/#TrixiParticles.SourceTermDamping"><code>SourceTermDamping</code></a>.                               Note that these source terms will not be used in the calculation of the                               boundary pressure when using a boundary with                               <a href="../boundary/#TrixiParticles.BoundaryModelDummyParticles"><code>BoundaryModelDummyParticles</code></a> and <a href="../boundary/#TrixiParticles.AdamiPressureExtrapolation"><code>AdamiPressureExtrapolation</code></a>.                               The keyword argument <code>acceleration</code> should be used instead for                               gravity-like source terms.</li><li><code>surface_tension</code>:            Surface tension model used for this SPH system. (default: no surface tension)</li><li><code>surface_normal_method</code>:      The surface normal method to be used for this SPH system.                               (default: no surface normal method or <code>ColorfieldSurfaceNormal()</code> if a surface_tension model is used)</li><li><code>reference_particle_spacing</code>: The reference particle spacing used for weighting values at the boundary,                               which currently is only needed when using surface tension.</li><li><code>color_value</code>:                The value used to initialize the color of particles in the system.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/system.jl#L1-L62">source</a></section></article><h2 id="equation_of_state"><a class="docs-heading-anchor" href="#equation_of_state">Equation of State</a><a id="equation_of_state-1"></a><a class="docs-heading-anchor-permalink" href="#equation_of_state" title="Permalink"></a></h2><p>The equation of state is used to relate fluid density to pressure and thus allow an explicit simulation of the <a href="#TrixiParticles.WeaklyCompressibleSPHSystem">WCSPH system</a>. The equation in the following formulation was introduced by <a href="../../references/#Cole1948">Cole (1948)</a> (pp. 39 and 43). The pressure <span>$p$</span> is calculated as</p><p class="math-container">\[    p = B \left(\left(\frac{\rho}{\rho_0}\right)^\gamma - 1\right) + p_{\text{background}},\]</p><p>where <span>$\rho$</span> denotes the density, <span>$\rho_0$</span> the reference density, and <span>$p_{\text{background}}$</span> the background pressure, which is set to zero when applied to free-surface flows (<a href="../../references/#Adami2012">Adami et al., 2012</a>).</p><p>The bulk modulus, <span>$B =  \frac{\rho_0 c^2}{\gamma}$</span>, is calculated from the artificial speed of sound <span>$c$</span> and the isentropic exponent <span>$\gamma$</span>.</p><p>An ideal gas equation of state with a linear relationship between pressure and density can be obtained by choosing <code>exponent=1</code>, i.e.</p><p class="math-container">\[    p = B \left( \frac{\rho}{\rho_0} -1 \right) = c^2(\rho - \rho_0).\]</p><p>For higher Reynolds numbers, <code>exponent=7</code> is recommended, whereas at lower Reynolds numbers <code>exponent=1</code> yields more accurate pressure estimates since pressure and density are proportional (see <a href="../../references/#Morris1997">Morris, 1997</a>).</p><p>When using <a href="../../general/density_calculators/#TrixiParticles.SummationDensity"><code>SummationDensity</code></a> (or <a href="../../callbacks/#TrixiParticles.DensityReinitializationCallback"><code>DensityReinitializationCallback</code></a>) and free surfaces, initializing particles with equal spacing will cause underestimated density and therefore strong attractive forces between particles at the free surface. Setting <code>clip_negative_pressure=true</code> can avoid this.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.StateEquationCole" href="#TrixiParticles.StateEquationCole"><code>TrixiParticles.StateEquationCole</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">StateEquationCole(; sound_speed, reference_density, exponent,
                  background_pressure=0.0, clip_negative_pressure=false)</code></pre><p>Equation of state to describe the relationship between pressure and density of water up to high pressures.</p><p><strong>Keywords</strong></p><ul><li><code>sound_speed</code>:             Artificial speed of sound.</li><li><code>reference_density</code>:       Reference density of the fluid.</li><li><code>exponent</code>:                A value of <code>7</code> is usually used for most simulations.</li><li><code>background_pressure=0.0</code>: Background pressure.</li><li><code>clip_negative_pressure=false</code>: Negative pressure values are clipped to 0, which prevents spurious surface tension with <code>SummationDensity</code> but allows unphysical rarefaction of the fluid.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/state_equations.jl#L1-L14">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.StateEquationIdealGas" href="#TrixiParticles.StateEquationIdealGas"><code>TrixiParticles.StateEquationIdealGas</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">StateEquationIdealGas( ;sound_speed, reference_density, gamma, background_pressure=0.0,
                       clip_negative_pressure=false)</code></pre><p>Equation of state to describe the relationship between pressure and density of a gas using the Ideal Gas Law.</p><p><strong>Keywords</strong></p><ul><li><code>sound_speed</code>                 : Artificial speed of sound.</li><li><code>reference_density</code>           : Reference density of the fluid.</li><li><code>gamma</code>                       : Heat-capacity ratio</li><li><code>background_pressure=0.0</code>     : Background pressure.</li><li><code>clip_negative_pressure=false</code>: Negative pressure values are clipped to 0, which prevents spurious surface tension with <code>SummationDensity</code> but allows unphysical rarefaction of the fluid.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/state_equations.jl#L54-L67">source</a></section></article><h2 id="density_diffusion"><a class="docs-heading-anchor" href="#density_diffusion">Density Diffusion</a><a id="density_diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#density_diffusion" title="Permalink"></a></h2><p>Density diffusion can be used with <a href="../../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a> to remove the noise in the pressure field. It is highly recommended to use density diffusion when using WCSPH.</p><h3 id="Formulation"><a class="docs-heading-anchor" href="#Formulation">Formulation</a><a id="Formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Formulation" title="Permalink"></a></h3><p>All density diffusion terms extend the continuity equation (see <a href="../../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a>) by an additional term</p><p class="math-container">\[\frac{\mathrm{d}\rho_a}{\mathrm{d}t} = \sum_{b} m_b v_{ab} \cdot \nabla W_{ab}
    + \delta h c \sum_{b} V_b \psi_{ab} \cdot \nabla W_{ab},\]</p><p>where <span>$V_b = m_b / \rho_b$</span> is the volume of particle <span>$b$</span> and <span>$\psi_{ab}$</span> depends on the density diffusion method (see <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> for available terms). Also, <span>$\rho_a$</span> denotes the density of particle <span>$a$</span> and <span>$r_{ab} = r_a - r_b$</span> is the difference of the coordinates, <span>$v_{ab} = v_a - v_b$</span> of the velocities of particles <span>$a$</span> and <span>$b$</span>.</p><h3 id="Numerical-Results"><a class="docs-heading-anchor" href="#Numerical-Results">Numerical Results</a><a id="Numerical-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-Results" title="Permalink"></a></h3><p>All density diffusion terms remove numerical noise in the pressure field and produce more accurate results than weakly commpressible SPH without density diffusion. This can be demonstrated with dam break examples in 2D and 3D. Here, <span>$δ = 0.1$</span> has been used for all terms. Note that, due to added stability, the adaptive time integration method that was used here can choose higher time steps in the simulations with density diffusion. For the cheap <a href="#TrixiParticles.DensityDiffusionMolteniColagrossi"><code>DensityDiffusionMolteniColagrossi</code></a>, this results in reduced runtime.</p><figure>
  <img src="https://github.com/trixi-framework/TrixiParticles.jl/assets/44124897/01289e3b-98ce-4b2d-8151-cd20782d5823" alt="density_diffusion_2d"/>
  <figcaption>Dam break in 2D with different density diffusion terms</figcaption>
</figure><figure>
  <img src="https://github.com/trixi-framework/TrixiParticles.jl/assets/44124897/63a05b2a-6c37-468e-b895-15ab142a4eba" alt="density_diffusion_3d"/>
  <figcaption>Dam break in 3D with different density diffusion terms</figcaption>
</figure><p>The simpler terms <a href="#TrixiParticles.DensityDiffusionMolteniColagrossi"><code>DensityDiffusionMolteniColagrossi</code></a> and <a href="#TrixiParticles.DensityDiffusionFerrari"><code>DensityDiffusionFerrari</code></a> do not solve the hydrostatic problem and lead to incorrect solutions in long-running steady-state hydrostatic simulations with free surfaces <a href="../../references/#Antuono2012">(Antuono et al., 2012)</a>. This can be seen when running the simple rectangular tank example until <span>$t = 40$</span> (again using <span>$δ = 0.1$</span>):</p><figure>
  <img src="https://github.com/trixi-framework/TrixiParticles.jl/assets/44124897/440debc9-6051-4a3b-aa9c-02a6b32fccf3" alt="density_diffusion_tank"/>
  <figcaption>Tank in rest under gravity in 3D with different density diffusion terms</figcaption>
</figure><p><a href="#TrixiParticles.DensityDiffusionAntuono"><code>DensityDiffusionAntuono</code></a> adds a correction term to solve this problem, but this term is very expensive and adds about 40–50% of computational cost.</p><h3 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.AbstractDensityDiffusion" href="#TrixiParticles.AbstractDensityDiffusion"><code>TrixiParticles.AbstractDensityDiffusion</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractDensityDiffusion</code></pre><p>An abstract supertype of all density diffusion formulations.</p><p>Currently, the following formulations are available:</p><table><tr><th style="text-align: left">Formulation</th><th style="text-align: left">Suitable for Steady-State Simulations</th><th style="text-align: left">Low Computational Cost</th></tr><tr><td style="text-align: left"><a href="#TrixiParticles.DensityDiffusionMolteniColagrossi"><code>DensityDiffusionMolteniColagrossi</code></a></td><td style="text-align: left">❌</td><td style="text-align: left">✅</td></tr><tr><td style="text-align: left"><a href="#TrixiParticles.DensityDiffusionFerrari"><code>DensityDiffusionFerrari</code></a></td><td style="text-align: left">❌</td><td style="text-align: left">✅</td></tr><tr><td style="text-align: left"><a href="#TrixiParticles.DensityDiffusionAntuono"><code>DensityDiffusionAntuono</code></a></td><td style="text-align: left">✅</td><td style="text-align: left">❌</td></tr></table><p>See <a href="#density_diffusion">Density Diffusion</a> for a comparison and more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/density_diffusion.jl#L1-L15">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.DensityDiffusionAntuono" href="#TrixiParticles.DensityDiffusionAntuono"><code>TrixiParticles.DensityDiffusionAntuono</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DensityDiffusionAntuono(initial_condition; delta)</code></pre><p>The commonly used density diffusion terms by <a href="../../references/#Antuono2010">Antuono (2010)</a>, also referred to as δ-SPH. The density diffusion term by <a href="../../references/#Molteni2009">Molteni (2009)</a> is extended by a second term, which is nicely written down by <a href="../../references/#Antuono2012">Antuono (2012)</a>.</p><p>The term <span>$\psi_{ab}$</span> in the continuity equation in <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> is defined by</p><p class="math-container">\[\psi_{ab} = 2\left(\rho_a - \rho_b - \frac{1}{2}\big(\nabla\rho^L_a + \nabla\rho^L_b\big) \cdot r_{ab}\right)
    \frac{r_{ab}}{\Vert r_{ab} \Vert^2},\]</p><p>where <span>$\rho_a$</span> and <span>$\rho_b$</span> denote the densities of particles <span>$a$</span> and <span>$b$</span> respectively and <span>$r_{ab} = r_a - r_b$</span> is the difference of the coordinates of particles <span>$a$</span> and <span>$b$</span>. The symbol <span>$\nabla\rho^L_a$</span> denotes the renormalized density gradient defined as</p><p class="math-container">\[\nabla\rho^L_a = -\sum_b (\rho_a - \rho_b) V_b L_a \nabla W_{ab}\]</p><p>with</p><p class="math-container">\[L_a := \left( -\sum_{b} V_b r_{ab} \otimes \nabla W_{ab} \right)^{-1} \in \R^{d \times d},\]</p><p>where <span>$d$</span> is the number of dimensions.</p><p>See <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> for an overview and comparison of implemented density diffusion terms.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/density_diffusion.jl#L85-L112">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.DensityDiffusionFerrari" href="#TrixiParticles.DensityDiffusionFerrari"><code>TrixiParticles.DensityDiffusionFerrari</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DensityDiffusionFerrari()</code></pre><p>A density diffusion term by <a href="../../references/#Ferrari2009">Ferrari (2009)</a>.</p><p>The term <span>$\psi_{ab}$</span> in the continuity equation in <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> is defined by</p><p class="math-container">\[\psi_{ab} = \frac{\rho_a - \rho_b}{h_a + h_b} \frac{r_{ab}}{\Vert r_{ab} \Vert},\]</p><p>where <span>$\rho_a$</span> and <span>$\rho_b$</span> denote the densities of particles <span>$a$</span> and <span>$b$</span> respectively, <span>$r_{ab} = r_a - r_b$</span> is the difference of the coordinates of particles <span>$a$</span> and <span>$b$</span> and <span>$h_a$</span> and <span>$h_b$</span> are the smoothing lengths of particles <span>$a$</span> and <span>$b$</span> respectively.</p><p>See <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> for an overview and comparison of implemented density diffusion terms.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/density_diffusion.jl#L54-L70">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.DensityDiffusionMolteniColagrossi" href="#TrixiParticles.DensityDiffusionMolteniColagrossi"><code>TrixiParticles.DensityDiffusionMolteniColagrossi</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DensityDiffusionMolteniColagrossi(; delta)</code></pre><p>The commonly used density diffusion term by <a href="../../references/#Molteni2009">Molteni (2009)</a>.</p><p>The term <span>$\psi_{ab}$</span> in the continuity equation in <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> is defined by</p><p class="math-container">\[\psi_{ab} = 2(\rho_a - \rho_b) \frac{r_{ab}}{\Vert r_{ab} \Vert^2},\]</p><p>where <span>$\rho_a$</span> and <span>$\rho_b$</span> denote the densities of particles <span>$a$</span> and <span>$b$</span> respectively and <span>$r_{ab} = r_a - r_b$</span> is the difference of the coordinates of particles <span>$a$</span> and <span>$b$</span>.</p><p>See <a href="#TrixiParticles.AbstractDensityDiffusion"><code>AbstractDensityDiffusion</code></a> for an overview and comparison of implemented density diffusion terms.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/weakly_compressible_sph/density_diffusion.jl#L25-L40">source</a></section></article><h2 id="shifting"><a class="docs-heading-anchor" href="#shifting">Particle Shifting Technique</a><a id="shifting-1"></a><a class="docs-heading-anchor-permalink" href="#shifting" title="Permalink"></a></h2><p>The Particle Shifting Technique (PST) is used to correct tensile instability in regions of low pressure, as observed in viscous flow around an object. Without PST, tensile instability causes non-physical separation of the fluid from the object, introducing void regions behind the object.</p><p>At lower resolutions, PST alone can be effective to correct a viscous flow around a cylinder, as shown in this figure. <img src="https://github.com/user-attachments/assets/70892b0b-af36-4531-b328-f73e63a5e33c" alt="particle_shifting"/> At higher resolutions, PST alone is not effective anymore; see the figure in <a href="#tic">Tensile Instability Control</a>. We recommend using PST and Tensile Instability Control together in such simulations.</p><h3 id="Mathematical-formulation"><a class="docs-heading-anchor" href="#Mathematical-formulation">Mathematical formulation</a><a id="Mathematical-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-formulation" title="Permalink"></a></h3><p>We use the following formulation by <a href="../../references/#Sun2018">Sun et al. (2018)</a>. After each time step, a correction term <span>$\delta r_a$</span> is added to the position <span>$r_a$</span> of particle <span>$a$</span>, which is given by</p><p class="math-container">\[\delta r_a = -4 \Delta t \, v_\text{max} h
    \sum_b \left( 1 + R \left( \frac{W_{ab}}{W(\Delta x_a)} \right)^n \right) \nabla W_{ab}
    \frac{m_b}{\rho_a + \rho_b},\]</p><p>where:</p><ul><li><span>$\Delta t$</span> is the time step,</li><li><span>$v_\text{max}$</span> is the maximum velocity over all particles,</li><li><span>$h$</span> is the smoothing length,</li><li><span>$R$</span> and <span>$n$</span> are constants, which are set to <span>$0.2$</span> and <span>$4$</span> respectively,</li><li><span>$W(\Delta x_a)$</span> is the smoothing kernel of the particle size of particle <span>$a$</span>, which can be interpreted as the target particle spacing that we want to achieve.</li><li><span>$\nabla W_{ab}$</span> is the gradient of the smoothing kernel,</li><li><span>$m_b$</span> is the mass of particle <span>$b$</span>,</li><li><span>$\rho_a, \rho_b$</span> is the density of particles <span>$a$</span> and <span>$b$</span>, respectively.</li></ul><p>Note that we replaced <span>$\text{CFL} \cdot \text{Ma}$</span> by <span>$\Delta t \cdot v_\text{max} / h$</span>, as explained in <a href="../../references/#Sun2018">Sun2018</a> on page 29, right above Equation 9.</p><p>The <span>$\delta$</span>-SPH method (WCSPH with density diffusion) together with this formulation of PST is commonly referred to as <span>$\delta^+$</span>-SPH.</p><p>To apply particle shifting, use the keyword argument <code>shifting_technique</code> in the constructor of a system that supports it.</p><h2 id="transport_velocity_formulation"><a class="docs-heading-anchor" href="#transport_velocity_formulation">Transport Velocity Formulation (TVF)</a><a id="transport_velocity_formulation-1"></a><a class="docs-heading-anchor-permalink" href="#transport_velocity_formulation" title="Permalink"></a></h2><p>An alternative formulation is the so-called Transport Velocity Formulation (TVF) by <a href="../../references/#Adami2013">Adami (2013)</a>. <a href="../../references/#Ramachandran2019">Ramachandran (2019)</a> applied the TVF also for the <a href="../entropically_damped_sph/#edac">EDAC</a> scheme.</p><p>The transport velocity <span>$\tilde{v}_a$</span> of particle <span>$a$</span> is used to evolve the position of the particle <span>$r_a$</span> from one time step to the next by</p><p class="math-container">\[\frac{\mathrm{d} r_a}{\mathrm{d}t} = \tilde{v}_a\]</p><p>and is obtained at every time step <span>$\Delta t$</span> from</p><p class="math-container">\[\tilde{v}_a (t + \Delta t) = v_a (t) + \Delta t \left(\frac{\tilde{\mathrm{d}} v_a}{\mathrm{d}t} - \frac{1}{\rho_a} \nabla p_{\text{background}} \right),\]</p><p>where <span>$\rho_a$</span> is the density of particle <span>$a$</span> and <span>$p_{\text{background}}$</span> is a constant background pressure field. The tilde in the second term of the right-hand side indicates that the material derivative has an advection part.</p><p>The discretized form of the last term is</p><p class="math-container">\[ -\frac{1}{\rho_a} \nabla p_{\text{background}} \approx  -\frac{p_{\text{background}}}{m_a} \sum_b \left(V_a^2 + V_b^2 \right) \nabla_a W_{ab},\]</p><p>where <span>$V_a$</span>, <span>$V_b$</span> denote the volume of particles <span>$a$</span> and <span>$b$</span> respectively. Note that although in the continuous case <span>$\nabla p_{\text{background}} = 0$</span>, the discretization is not 0th-order consistent for <strong>non</strong>-uniform particle distribution, which means that there is a non-vanishing contribution only when particles are disordered. That also means that <span>$p_{\text{background}}$</span> occurs as pre-factor to correct the trajectory of a particle resulting in uniform pressure distributions. Suggested is a background pressure which is in the order of the reference pressure, but it can be chosen arbitrarily large when the time-step criterion is adjusted.</p><p>The inviscid momentum equation with an additional convection term for a particle moving with <span>$\tilde{v}$</span> is</p><p class="math-container">\[\frac{\tilde{\mathrm{d}} \left( \rho v \right)}{\mathrm{d}t} = -\nabla p +  \nabla \cdot \bm{A},\]</p><p>where the tensor <span>$\bm{A} = \rho v\left(\tilde{v}-v\right)^T$</span> is a consequence of the modified advection velocity and can be interpreted as the convection of momentum with the relative velocity <span>$\tilde{v}-v$</span>.</p><p>The discretized form of the momentum equation for a particle <span>$a$</span> reads as</p><p class="math-container">\[\frac{\tilde{\mathrm{d}} v_a}{\mathrm{d}t} = \frac{1}{m_a} \sum_b \left(V_a^2 + V_b^2 \right) \left[ -\tilde{p}_{ab} \nabla_a W_{ab} + \frac{1}{2} \left(\bm{A}_a + \bm{A}_b \right) \cdot \nabla_a W_{ab} \right].\]</p><p>Here, <span>$\tilde{p}_{ab}$</span> is the density-weighted pressure</p><p class="math-container">\[\tilde{p}_{ab} = \frac{\rho_b p_a + \rho_a p_b}{\rho_a + \rho_b},\]</p><p>with the density <span>$\rho_a$</span>, <span>$\rho_b$</span> and the pressure <span>$p_a$</span>, <span>$p_b$</span> of particles <span>$a$</span> and <span>$b$</span>, respectively. <span>$\bm{A}_a$</span> and <span>$\bm{A}_b$</span> are the convection tensors for particle <span>$a$</span> and <span>$b$</span>, respectively, and are given, e.g., for particle <span>$a$</span>, as <span>$\bm{A}_a = \rho v_a\left(\tilde{v}_a-v_a\right)^T$</span>.</p><p>To apply the TVF, use the keyword argument <code>shifting_technique</code> in the constructor of a system that supports it.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.ContinuityEquationTermSun2019" href="#TrixiParticles.ContinuityEquationTermSun2019"><code>TrixiParticles.ContinuityEquationTermSun2019</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ContinuityEquationTermSun2019()</code></pre><p>A second term by <a href="../../references/#Sun2019">Sun et al. (2019)</a> to be added to the continuity equation to solve the stability problems with the modified continuity equation at solid wall boundaries.</p><p>See <a href="#TrixiParticles.ParticleShiftingTechnique"><code>ParticleShiftingTechnique</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L371-L378">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.MomentumEquationTermSun2019" href="#TrixiParticles.MomentumEquationTermSun2019"><code>TrixiParticles.MomentumEquationTermSun2019</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">MomentumEquationTermSun2019()</code></pre><p>A term by <a href="../../references/#Sun2019">Sun et al. (2019)</a> to be added to the momentum equation.</p><p>See <a href="#TrixiParticles.ParticleShiftingTechnique"><code>ParticleShiftingTechnique</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L317-L323">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.ParticleShiftingTechnique" href="#TrixiParticles.ParticleShiftingTechnique"><code>TrixiParticles.ParticleShiftingTechnique</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ParticleShiftingTechnique(; integrate_shifting_velocity=true,
                          update_everystage=false,
                          modify_continuity_equation=true,
                          second_continuity_equation_term=ContinuityEquationTermSun2019(),
                          momentum_equation_term=MomentumEquationTermSun2019(),
                          v_max_factor=1, sound_speed_factor=0)</code></pre><p>Particle Shifting Technique by <a href="../../references/#Sun2017">Sun et al. (2017)</a> and <a href="../../references/#Sun2019">Sun et al. (2019)</a>. The keyword arguments allow to choose between the original methods from the two papers and variants in between.</p><p>The default values of the keyword arguments provide the version of shifting that we recommend based on our experiments. The default values are subject to change in future releases.</p><p>See <a href="#shifting">Particle Shifting Technique</a> for more information on the method.</p><p>We provide the following convenience constructors for common variants of the method:</p><ul><li><a href="#TrixiParticles.ParticleShiftingTechniqueSun2017-Tuple{}"><code>ParticleShiftingTechniqueSun2017()</code></a>:   Particle Shifting Technique by <a href="../../references/#Sun2017">Sun et al. (2017)</a>.   Shifting is applied as a position correction in a callback after each time step.   No additional terms are added to the momentum or continuity equations.</li><li><a href="#TrixiParticles.ConsistentShiftingSun2019-Tuple{}"><code>ConsistentShiftingSun2019()</code></a>:   Consistent Particle Shifting Technique by <a href="../../references/#Sun2019">Sun et al. (2019)</a>.   Shifting is applied with a shifting velocity in each stage of the time integration.   Additional terms are added to the momentum and continuity equations, most importantly   to guarantee conservation of volume in closed systems, which is not the case for the   original method by <a href="../../references/#Sun2017">Sun et al. (2017)</a>.</li></ul><p><strong>Keywords</strong></p><ul><li><code>integrate_shifting_velocity</code>: If <code>true</code>, the shifting is applied in each stage of the                               time integration method as a shifting velocity that is                               added to the physical velocity in the time integration.                               If <code>false</code>, the shifting is applied as a position correction                               in a callback after each time step.</li><li><code>update_everystage</code>:          If <code>true</code>, the shifting velocity is updated in every stage                               of a multi-stage time integration method.                               This requires <code>integrate_shifting_velocity=true</code>.                               If <code>false</code>, the shifting velocity is only updated once                               per time step in a callback, and the same shifting velocity                               is used for all stages.                               <code>update_everystage=false</code> reduces the computational cost,                               but may reduce the stability of the scheme and require                               a smaller time step.</li><li><code>modify_continuity_equation</code>: If <code>true</code>, the continuity equation is modified to be based                               on the transport velocity instead of the physical velocity.                               This guarantees conservation of volume in closed systems,                               but is unstable at solid wall boundaries, according to our                               experiments.                               This requires <code>integrate_shifting_velocity=true</code>.</li><li><code>second_continuity_equation_term</code>: Additional term to be added to the                               continuity equation to solve the stability problems with                               the modified continuity equation at solid wall boundaries.                               This requires <code>modify_continuity_equation=true</code>.                               See <a href="#TrixiParticles.ContinuityEquationTermSun2019"><code>ContinuityEquationTermSun2019</code></a>.</li><li><code>momentum_equation_term</code>:     Additional term to be added to the momentum equation                               to account for the shifting velocity.                               This requires <code>integrate_shifting_velocity=true</code>.                               See <a href="#TrixiParticles.MomentumEquationTermSun2019"><code>MomentumEquationTermSun2019</code></a>.</li><li><code>v_max_factor</code>:               Factor to scale the expected maximum velocity used in the                               shifting velocity. The maximum expected velocity is computed as                               <code>v_max_factor * max(|v|)</code>, where <code>v</code> is the physical velocity.                               As opposed to <code>sound_speed_factor</code>, the computed expected                               maximum velocity depends on the current flow field                               and can change over time.                               Only one of <code>v_max_factor</code> and <code>sound_speed_factor</code>                               can be non-zero.</li><li><code>sound_speed_factor</code>:         Factor to compute the maximum expected velocity used in the                               shifting velocity from the speed of sound.                               The maximum expected velocity is computed as                               <code>sound_speed_factor * c</code>, where <code>c</code> is the speed of sound.                               Only one of <code>v_max_factor</code> and <code>sound_speed_factor</code>                               can be non-zero.</li></ul><div class="admonition is-warning" id="Warning-f5db21701008ea9e"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-f5db21701008ea9e" title="Permalink"></a></header><div class="admonition-body"><p>The Particle Shifting Technique needs to be disabled close to the free surface and therefore requires a free surface detection method. This is not yet implemented. <strong>This technique cannot be used in a free surface simulation.</strong></p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L58-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.TransportVelocityAdami" href="#TrixiParticles.TransportVelocityAdami"><code>TrixiParticles.TransportVelocityAdami</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TransportVelocityAdami(; background_pressure::Real, modify_continuity_equation=false)</code></pre><p>Transport Velocity Formulation (TVF) by <a href="../../references/#Adami2013">Adami et al. (2013)</a> to suppress pairing and tensile instability. See <a href="#transport_velocity_formulation">TVF</a> for more details of the method.</p><p><strong>Keywords</strong></p><ul><li><code>background_pressure</code>: Background pressure. Suggested is a background pressure which is                        on the order of the reference pressure.</li><li><code>modify_continuity_equation</code>: If <code>true</code>, the continuity equation is modified to be based                               on the transport velocity instead of the physical velocity.                               This guarantees conservation of volume in closed systems,                               but is unstable at solid wall boundaries, according to our                               experiments.</li></ul><div class="admonition is-warning" id="Warning-f3f1c923dc625195"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-f3f1c923dc625195" title="Permalink"></a></header><div class="admonition-body"><p>The Transport Velocity Formulation needs to be disabled close to the free surface and therefore requires a free surface detection method. This is not yet implemented. <strong>This technique cannot be used in a free surface simulation.</strong></p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L544-L564">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.ConsistentShiftingSun2019-Tuple{}" href="#TrixiParticles.ConsistentShiftingSun2019-Tuple{}"><code>TrixiParticles.ConsistentShiftingSun2019</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ConsistentShiftingSun2019(; sound_speed_factor=0.1, kwargs...)</code></pre><p>Consistent Particle Shifting Technique by <a href="../../references/#Sun2019">Sun et al. (2019)</a>.</p><p>This is a convenience constructor for:</p><pre><code class="language-julia hljs">ParticleShiftingTechnique(integrate_shifting_velocity=true,
                          update_everystage=true,
                          modify_continuity_equation=true,
                          second_continuity_equation_term=ContinuityEquationTermSun2019(),
                          momentum_equation_term=MomentumEquationTermSun2019(),
                          v_max_factor=0, sound_speed_factor=0.1)</code></pre><p>See <a href="#TrixiParticles.ParticleShiftingTechnique">ParticleShiftingTechnique</a> for all available options.</p><p><strong>Keywords</strong></p><ul><li><code>sound_speed_factor</code>: Factor to compute the maximum expected velocity used in the                       shifting velocity from the speed of sound.                       The maximum expected velocity is computed as                       <code>sound_speed_factor * c</code>, where <code>c</code> is the speed of sound.                       Since the speed of sound is usually chosen as 10 times the maximum                       expected velocity in weakly compressible SPH, a value of 0.1                       corresponds to the maximum expected velocity.</li><li><code>kwargs...</code>: All keywords are passed to the main constructor.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs">shifting_technique = ConsistentShiftingSun2019()</code></pre><div class="admonition is-warning" id="Warning-f5db21701008ea9e"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-f5db21701008ea9e" title="Permalink"></a></header><div class="admonition-body"><p>The Particle Shifting Technique needs to be disabled close to the free surface and therefore requires a free surface detection method. This is not yet implemented. <strong>This technique cannot be used in a free surface simulation.</strong></p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L252-L294">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.ParticleShiftingTechniqueSun2017-Tuple{}" href="#TrixiParticles.ParticleShiftingTechniqueSun2017-Tuple{}"><code>TrixiParticles.ParticleShiftingTechniqueSun2017</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ParticleShiftingTechniqueSun2017(; kwargs...)</code></pre><p>Particle Shifting Technique by <a href="../../references/#Sun2017">Sun et al. (2017)</a>. Following the original paper, the callback is applied in every time step and not in every stage of a multi-stage time integration method to reduce the computational cost.</p><p>This is a convenience constructor for:</p><pre><code class="language-julia hljs">ParticleShiftingTechnique(integrate_shifting_velocity=false,
                          update_everystage=false,
                          modify_continuity_equation=false,
                          second_continuity_equation_term=nothing,
                          momentum_equation_term=nothing,
                          v_max_factor=1, sound_speed_factor=0)</code></pre><p>See <a href="#TrixiParticles.ParticleShiftingTechnique">ParticleShiftingTechnique</a> for all available options.</p><p><strong>Keywords</strong></p><ul><li><code>kwargs...</code>: All keywords are passed to the main constructor.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia hljs">shifting_technique = ParticleShiftingTechniqueSun2017()</code></pre><div class="admonition is-warning" id="Warning-f5db21701008ea9e"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-f5db21701008ea9e" title="Permalink"></a></header><div class="admonition-body"><p>The Particle Shifting Technique needs to be disabled close to the free surface and therefore requires a free surface detection method. This is not yet implemented. <strong>This technique cannot be used in a free surface simulation.</strong></p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/shifting_techniques.jl#L204-L241">source</a></section></article><h2 id="tic"><a class="docs-heading-anchor" href="#tic">Tensile Instability Control</a><a id="tic-1"></a><a class="docs-heading-anchor-permalink" href="#tic" title="Permalink"></a></h2><p>Tensile Instability Control (TIC) is a pressure acceleration formulation to correct tensile instability in regions of low pressure, as observed in viscous flow around an object. The technique was introduced by <a href="../../references/#Sun2018">Sun et al. (2018)</a>. The formulation is described in Section 2.1 of this paper. It can be used in combination with the <a href="#shifting">Particle Shifting Technique (PST)</a> to effectively prevent non-physical separation of the fluid from the object.</p><p>As can be seen in the following figure, TIC alone can cause instabilities and does not improve the simulation. PST alone can mostly prevent separation at lower resolutions. A small void region is still visible, but quickly disappears. The combination of PST and TIC prevents separation effectively. <img src="https://github.com/user-attachments/assets/5b30d440-8ca5-4c13-94d0-d110de2eb7cc" alt="low_res"/></p><p>At higher resolutions, PST alone is not effective to prevent separation, as can be seen in the next figure. Only the combination of PST and TIC is able to produce physical results. <img src="https://github.com/user-attachments/assets/674aec76-33e6-4ee3-bcd7-ba8c381a2775" alt="high_res"/></p><h3 id="Mathematical-formulation-2"><a class="docs-heading-anchor" href="#Mathematical-formulation-2">Mathematical formulation</a><a class="docs-heading-anchor-permalink" href="#Mathematical-formulation-2" title="Permalink"></a></h3><p>The force that particle <span>$a$</span> experiences from particle <span>$b$</span> due to pressure is given by</p><p class="math-container">\[f_{ab} = -m_a m_b \frac{p_a + p_b}{\rho_a \rho_b} \nabla W_{ab}\]</p><p>for the WCSPH method with <a href="../../general/density_calculators/#TrixiParticles.ContinuityDensity"><code>ContinuityDensity</code></a>.</p><p>The TIC formulation changes this force to</p><p class="math-container">\[f_{ab} = -m_a m_b \frac{|p_a| + p_b}{\rho_a \rho_b} \nabla W_{ab}.\]</p><p>Note that this formulation is asymmetric and sacrifices conservation of linear and angular momentum.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TrixiParticles.tensile_instability_control" href="#TrixiParticles.tensile_instability_control"><code>TrixiParticles.tensile_instability_control</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tensile_instability_control</code></pre><p>Pressure acceleration formulation to prevent tensile instability by <a href="../../references/#Sun2018">Sun et al. (2018)</a>.</p><p>This formulation can be passed as keyword argument <code>pressure_acceleration</code> to the <a href="#TrixiParticles.WeaklyCompressibleSPHSystem"><code>WeaklyCompressibleSPHSystem</code></a> constructor. See <a href="#tic">Tensile Instability Control</a> for more information on this technique.</p><div class="admonition is-warning" id="Warning-a7f5fa9dde791d98"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-a7f5fa9dde791d98" title="Permalink"></a></header><div class="admonition-body"><p>Tensile Instability Control needs to be disabled close to the free surface and therefore requires a free surface detection method. This is not yet implemented. <strong>This technique cannot be used in a free surface simulation.</strong></p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/trixi-framework/TrixiParticles.jl/blob/6140b41a9ab3d5cc2d106a8951c45ec5bf6c4cff/src/schemes/fluid/pressure_acceleration.jl#L39-L53">source</a></section></article><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fluid/">« Overview</a><a class="docs-footer-nextpage" href="../entropically_damped_sph/">Entropically Damped Artificial Compressibility for SPH (Fluid) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Saturday 1 November 2025 14:44">Saturday 1 November 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
